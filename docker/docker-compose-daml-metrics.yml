# Metrics for vDAML
#
# Usage: docker-compose -f docker-compose-daml.yml -f docker-compose-daml-metrics.yml
# Note: Make sure you adjust the configuration in vdaml-metrics/*

version: '3'
services:
  telegraf:
    image: telegraf:1.14.0
    ports:
      - 9090:9090
    volumes:
      - ./vdaml-metrics/telegraf.conf:/etc/telegraf/telegraf.conf
      - /var/run/docker.sock:/var/run/docker.sock
      - /:/hostfs:ro
    environment:
      - HOST_MOUNT_PREFIX=/hostfs
      - HOST_PROC=/hostfs/proc
    depends_on:
      - wavefront
      - daml_ledger_api1
      - daml_execution_engine1

  jaeger-agent:
    image: jaegertracing/jaeger-agent:1.17
    ports:
      - 5775:5775/udp
      - 6831:6831/udp
      - 6832:6832/udp
      - 5778:5778/tcp
    environment:
      REPORTER_TCHANNEL_HOST_PORT: wavefront:14267
      REPORTER_TYPE: tchannel
    depends_on:
      - wavefront

  wavefront:
    image: wavefronthq/proxy:6.1
    volumes:
      - ./vdaml-metrics/wavefront.conf:/config/wavefront-proxy/wavefront.conf
    environment:
      - WAVEFRONT_PROXY_ARGS=-f /config/wavefront-proxy/wavefront.conf
    ports:
      - 2878:2878
      - 14267:14267
